---
import { UserCard } from "@krag/react-ui";
import {
	signOut,
	useSession,
	passkeyActions,
	useListPasskeys,
	twoFactorActions,
	updateUser,
	revokeSession,
} from "../lib/auth-client";
import Layout from '../layouts/DashboardLayout.astro';
import { auth } from "../lib/auth";

const session = await auth.api.getSession({
  headers: Astro.request.headers,
});

if (!session) {
  return Astro.redirect("/sign-in");
}

// Get all active sessions for the user
const activeSessions = await auth.api.listSessions({
  headers: Astro.request.headers,
});

const sessionsArray = Array.isArray(activeSessions) ? activeSessions : [];
---

<Layout title="Account">
  <div class="container mx-auto py-12 max-w-4xl">
    <h1 class="text-3xl font-bold mb-8">Account Settings</h1>
    <div class="container mx-auto py-8">
			<UserCard 
				client:load
				activeSessions={sessionsArray}
				initialSession={session}
				useSession={useSession}
				signOut={signOut}
				updateUser={updateUser}
				revokeSession={revokeSession}
				passkeyActions={passkeyActions}
				useListPasskeys={useListPasskeys}
				twoFactorActions={twoFactorActions}
			/>
    </div>
  </div>
</Layout>
