---
import { Account } from "../components/account";
import Layout from '../layouts/DashboardLayout.astro';
import { auth } from "../lib/auth";

const session = await auth.api.getSession({
  headers: Astro.request.headers,
});

if (!session) {
  return Astro.redirect("/sign-in");
}

// Get all active sessions for the user
const activeSessions = await auth.api.listSessions({
  headers: Astro.request.headers,
});

const sessionsArray = Array.isArray(activeSessions) ? activeSessions : [];
---

<Layout title="Account">
  <div class="container mx-auto py-12 max-w-4xl">
    <h1 class="text-3xl font-bold mb-8">Account Settings</h1>
    <Account 
      client:load
      activeSessions={sessionsArray}
      initialSession={session}
    />
  </div>
</Layout>
