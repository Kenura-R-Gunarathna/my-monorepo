---
import { App, TRPCProvider } from "@krag/react-ui";
import Layout from '../layouts/DashboardLayout.astro';
import { auth } from "../lib/auth";

const session = await auth.api.getSession({
  headers: Astro.request.headers,
});

if (!session) {
  return Astro.redirect("/sign-in");
}
---

<Layout title="Dashboard">
  <TRPCProvider client:only="react">
    <App 
      basepath="/dashboard" 
      platform="astro"
      initialSession={session}
    />
  </TRPCProvider>
</Layout>
